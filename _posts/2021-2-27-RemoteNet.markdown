---
layout: post
title:  "远程控制协议之动态解析"
date:   2020-2-27 14:33:29 +0500
---
攻击者可以动态建立与命令和控制基础结构的连接，以逃避常见的检测和补救
措施。这可以通过使用与攻击者用来接收恶意软件通信的基础结构共享通用算
法的恶意软件来实现。这些计算可用于动态调整参数，例如恶意软件用于命令
和控制的域名，IP地址或端口号。
😁🤣
{% highlight ruby %}

攻击者可能出于降级渠道的目的而使用动态解决方案。当失去与主要命令和控制
服务器的联系时，恶意软件可能会采用动态解决方案来重新建立命令和控制
1)	域名生成算法DGA
攻击者可以利用域生成算法（DGA）来动态标识命令和控制流量的目标域，而不
是依赖于静态IP地址或域的列表。这样做的好处是，防御者很难阻止，跟踪或接
管命令和控制通道，因为恶意软件可能会检查成千上万个域，以检查指令。

DGA通过生成每个字母来构造域名时，可以采取看似随机或“乱码”字符串的形式
（例如：istgmxdejdnxuyla.ru）。或者，某些DGA通过将单词（而不是字母）串联
在一起来使用整个单词作为单位（例如：cityjulydish.net）。许多DGA基于时间，在
每个时间段（每小时，每天，每月等）生成一个不同的域。其他一些也包含种子值，
这使得防御者很难预测未来的领域。

攻击者可能出于后备渠道的目的而使用DGA 。当失去与主要命令和控制服务器的联系
时，恶意软件可能会采用DGA作为重新建立命令和控制的手段
2)	Fast Flux DNS
攻击者可以使用Fast Flux DNS将命令和控制通道隐藏在链接到单个域解析的一系列快
速变化的IP地址后面。此技术使用完全限定的域名，并为其分配了多个IP地址，这些
域名被高频交换，并结合使用轮询IP地址和DNS资源记录的短生存时间（TTL）。

最简单的“单通量”方法涉及注册和注销地址，作为单个DNS名称的DNS A（地址）
记录列表的一部分。这些注册的平均寿命为五分钟，从而导致IP地址解析的不断变化。

相反，“双通”方法注册和注销地址作为DNS区域的DNS名称服务器记录列表的一部
分，从而为连接提供了额外的弹性。使用双通量，其他主机可以充当C2主机的代理，
从而进一步隔离了C2通道的真实来源

3)	DNS解析
攻击者可以对DNS结果中返回的地址进行计算，以确定要用于命令和控制的端口和IP地
址，而不是依赖于预定的端口号或实际返回的IP地址。IP和/或端口号计算可以用来绕过
C2通道上的出口过滤。


DNS计算的一种实现方式是在DNS响应中获取IP地址的前三个八位字节，并使用这些值
来计算用于命令和控制流量的端口
